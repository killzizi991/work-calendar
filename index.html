<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, 
          maximum-scale=1.0, user-scalable=no, 
          viewport-fit=cover">
    <title>–ö–∞–ª–µ–Ω–¥–∞—Ä—å –ø—Ä–æ–¥–∞–∂</title>
    <meta name="theme-color" content="#4e73df">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css">
    
    <!-- PWA –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è -->
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="–ö–∞–ª–µ–Ω–¥–∞—Ä—å –ø—Ä–æ–¥–∞–∂">
</head>
<body>
    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="app-loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...</div>
    
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="header">
        <div class="header-container">
            <button id="prev-month">&lt;</button>
            <button id="month-year-selector" class="month-selector">
                <h2 id="current-month-year">–ò—é–ª—å 2025</h2>
            </button>
            <button id="next-month">&gt;</button>
            <button id="settings-btn" style="margin-left: 10px;">‚öôÔ∏è</button>
        </div>
        
        <div class="tools-container">
            <button id="palette-btn" class="palette-btn">üé®</button>
            <button id="summary-btn">–†–∞—Å—á–µ—Ç—ã</button>
        </div>
    </div>
    
    <!-- –ü–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –ø–∞–ª–∏—Ç—Ä—ã -->
    <div id="palette-panel" class="palette-panel">
        <div class="palette-tools">
            <div class="palette-tool fill" data-color="#ffffff" style="background-color: #ffffff; border: 1px solid #e9ecef;"></div>
            <div class="palette-tool fill" data-color="#f8d7da" style="background-color: #f8d7da;"></div>
            <div class="palette-tool fill" data-color="#d4edda" style="background-color: #d4edda;"></div>
            <div class="palette-tool fill" data-color="#d1ecf1" style="background-color: #d1ecf1;"></div>
            <div class="palette-tool fill" data-color="#fff3cd" style="background-color: #fff3cd;"></div>
            <div class="palette-tool fill" data-color="#d1ecf1" style="background-color: #d1ecf1;"></div>
            <div class="palette-tool fill" data-color="#d4edda" style="background-color: #d4edda;"></div>
            <div id="palette-border" class="palette-tool" title="–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –æ–±–≤–æ–¥–∫–∞">üî≤</div>
        </div>
    </div>
    
    <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å -->
    <div id="calendar" class="calendar"></div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>–î–µ–Ω—å <span id="modal-day"></span></h3>
            <input type="number" id="sales-input" placeholder="–°—É–º–º–∞ –ø—Ä–æ–¥–∞–∂" inputmode="numeric">
            <textarea id="comment-input" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"></textarea>
            <div class="color-picker">
                <div class="color-option" style="background-color: #ffffff; border: 1px solid #e9ecef;" data-color="#ffffff"></div>
                <div class="color-option" style="background-color: #f8d7da;" data-color="#f8d7da"></div>
                <div class="color-option" style="background-color: #d4edda;" data-color="#d4edda"></div>
                <div class="color-option" style="background-color: #d1ecf1;" data-color="#d1ecf1"></div>
                <div class="color-option" style="background-color: #fff3cd;" data-color="#fff3cd"></div>
                <div class="color-option" style="background-color: #d1ecf1;" data-color="#d1ecf1"></div>
                <div class="color-option" style="background-color: #d4edda;" data-color="#d4edda"></div>
            </div>
            <button id="save-data">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>
    
    <div id="summary-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>–†–∞—Å—á–µ—Ç—ã –∑–∞ <span id="summary-month-year">–ò—é–ª—å 2025</span></h3>
            <div class="summary-results">
                <p>–†–∞–±–æ—á–∏—Ö –¥–Ω–µ–π: <span id="modal-work-days">0</span></p>
                <p>–°—É–º–º–∞ –ø—Ä–æ–¥–∞–∂: <span id="modal-total-sales">0</span> —Ä—É–±</p>
                <p>–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: <span id="modal-total-earned">0</span> —Ä—É–±</p>
                <p>–ó–∞—Ä–ø–ª–∞—Ç–∞: <span id="modal-salary">0</span> —Ä—É–±</p>
                <p>–û—Å—Ç–∞—Ç–æ–∫: <span id="modal-balance">0</span> —Ä—É–±</p>
            </div>
        </div>
    </div>
    
    <div id="period-modal" class="modal">
        <div class="modal-content period-selector">
            <span class="close">&times;</span>
            <h3>–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥</h3>
            <div class="period-step" id="year-step">
                <h4>–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ–¥</h4>
                <div class="period-options" id="year-options"></div>
            </div>
            <div class="period-step" id="month-step" style="display:none">
                <h4>–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—è—Ü</h4>
                <div class="period-options" id="month-options"></div>
            </div>
            <button id="period-back" style="display:none">‚Üê –ù–∞–∑–∞–¥</button>
        </div>
    </div>

    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞—Å—á–µ—Ç–æ–≤</h3>
            
            <div class="setting-group">
                <label>
                    <input type="checkbox" id="tax-toggle" checked>
                    –£—á–∏—Ç—ã–≤–∞—Ç—å –Ω–∞–ª–æ–≥ (13%)
                </label>
            </div>
            
            <div class="setting-group">
                <label>–ü—Ä–æ—Ü–µ–Ω—Ç —Å –ø—Ä–æ–¥–∞–∂ (%):</label>
                <input type="number" id="sales-percent" value="7" min="0" max="100" step="0.1">
            </div>
            
            <div class="setting-group">
                <label>–°—Ç–∞–≤–∫–∞ –∑–∞ —Å–º–µ–Ω—É (—Ä—É–±):</label>
                <input type="number" id="shift-rate" value="1000" min="0" step="100">
            </div>
            
            <div class="setting-group">
                <label>–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã—á–µ—Ç (—Ä—É–±):</label>
                <input type="number" id="fixed-deduction" value="25000" min="0" step="1000">
            </div>
            
            <div class="setting-group">
                <label>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞–¥–±–∞–≤–∫–∞ (—Ä—É–±):</label>
                <input type="number" id="extra-bonus" value="10875" min="0" step="1000">
            </div>

            <div class="setting-group" style="display: flex; gap: 10px; margin-top: 20px;">
                <button id="export-btn" style="flex: 1;">–≠–∫—Å–ø–æ—Ä—Ç</button>
                <button id="import-btn" style="flex: 1;">–ò–º–ø–æ—Ä—Ç</button>
            </div>
            
            <button id="save-settings">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        </div>
    </div>

    <!-- –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ -->
    <input type="file" id="import-file" accept=".json" style="display: none;">

    <script src="script.js"></script>
    <script>
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞ –ø—Ä–∏ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏
        const SW_VERSION = 'v4'; // –î–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –≤–µ—Ä—Å–∏–µ–π –≤ sw.js
        if (localStorage.getItem('sw_version') !== SW_VERSION) {
          caches.keys().then(cacheNames => {
            cacheNames.forEach(cacheName => caches.delete(cacheName));
          }).then(() => {
            localStorage.setItem('sw_version', SW_VERSION);
            console.log('–ö–µ—à –æ—á–∏—â–µ–Ω –¥–ª—è –≤–µ—Ä—Å–∏–∏', SW_VERSION);
          });
        }

        window.addEventListener('load', () => {
            document.getElementById('app-loading').style.display = 'none';
            
            // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('SW registered'))
                    .catch(err => console.error('SW registration error:', err));
            }
        });
    </script>
</body>
</html>
