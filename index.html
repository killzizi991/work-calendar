<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, 
          maximum-scale=1.0, user-scalable=no, 
          viewpoint-fit=cover">
    <title>–ö–∞–ª–µ–Ω–¥–∞—Ä—å –ø—Ä–æ–¥–∞–∂</title>
    <meta name="theme-color" content="#4a6cf7">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css">
    
    <!-- PWA –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è -->
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="–ö–∞–ª–µ–Ω–¥–∞—Ä—å –ø—Ä–æ–¥–∞–∂">
</head>
<body>
    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="app-loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...</div>
    
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="header">
        <div class="header-container">
            <button id="prev-month">&lt;</button>
            <button id="month-year-selector" class="month-selector">
                <h2 id="current-month-year">–ò—é–ª—å 2025</h2>
            </button>
            <button id="next-month">&gt;</button>
            <button id="help-btn">?</button>
            <button id="settings-btn">‚öôÔ∏è</button>
        </div>
        
        <div class="tools-container">
            <button id="palette-btn" class="palette-btn">üé®</button>
            <button id="summary-btn">–†–∞—Å—á–µ—Ç—ã</button>
        </div>
    </div>
    
    <!-- –ü–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –ø–∞–ª–∏—Ç—Ä—ã -->
    <div id="palette-panel" class="palette-panel">
        <div class="palette-tools">
            <div class="palette-tool fill" data-color="#ffffff" style="background-color: #ffffff; border: 1px solid #e2e8f0;"></div>
            <div class="palette-tool fill" data-color="#bbdefb" style="background-color: #bbdefb;"></div>
            <div class="palette-tool fill" data-color="#c8e6c9" style="background-color: #c8e6c9;"></div>
            <div class="palette-tool fill" data-color="#b2ebf2" style="background-color: #b2ebf2;"></div>
            <div class="palette-tool fill" data-color="#fff9c4" style="background-color: #fff9c4;"></div>
            <div class="palette-tool fill" data-color="#e1bee7" style="background-color: #e1bee7;"></div>
            <div class="palette-tool fill" data-color="#f8bbd0" style="background-color: #f8bbd0;"></div>
            <div id="palette-border" class="palette-tool" title="–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –æ–±–≤–æ–¥–∫–∞">üî≤</div>
        </div>
    </div>
    
    <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å -->
    <div id="calendar" class="calendar"></div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>–î–µ–Ω—å <span id="modal-day"></span></h3>
            <input type="number" id="sales-input" placeholder="–°—É–º–º–∞ –ø—Ä–æ–¥–∞–∂" inputmode="numeric">
            <textarea id="comment-input" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"></textarea>
            <div class="color-picker">
                <div class="color-option" style="background-color: #ffffff; border: 1px solid #e2e8f0;" data-color="#ffffff"></div>
                <div class="color-option" style="background-color: #bbdefb;" data-color="#bbdefb"></div>
                <div class="color-option" style="background-color: #c8e6c9;" data-color="#c8e6c9"></div>
                <div class="color-option" style="background-color: #b2ebf2;" data-color="#b2ebf2"></div>
                <div class="color-option" style="background-color: #fff9c4;" data-color="#fff9c4"></div>
                <div class="color-option" style="background-color: #e1bee7;" data-color="#e1bee7"></div>
                <div class="color-option" style="background-color: #f8bbd0;" data-color="#f8bbd0"></div>
            </div>
            
            <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–Ω—è -->
            <button id='day-settings-btn' style='margin-top: 10px; background: #6c757d;'>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–Ω—è</button>
            
            <!-- –ë–ª–æ–∫ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–Ω—è (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç) -->
            <div id='day-settings' style='display: none; margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 5px;'>
                <h4>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —ç—Ç–æ–≥–æ –¥–Ω—è</h4>
                <div class='setting-group'>
                    <label>–ü—Ä–æ—Ü–µ–Ω—Ç —Å –ø—Ä–æ–¥–∞–∂ (%):</label>
                    <input type='number' id='day-sales-percent' min='0' max='100' step='0.1'>
                </div>
                <div class='setting-group'>
                    <label>–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã—Ö–æ–¥ (—Ä—É–±):</label>
                    <input type='number' id='day-shift-rate' min='0' step='100'>
                </div>
                <button id='reset-day-settings' style='background: #dc3545; margin-top: 10px;'>–°–±—Ä–æ—Å–∏—Ç—å –∫ –æ–±—â–∏–º</button>
            </div>
            
            <button id="save-data">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>
    
    <div id="summary-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>–†–∞—Å—á–µ—Ç—ã –∑–∞ <span id="summary-month-year">–ò—é–ª—å 2025</span></h3>
            <div class="summary-results">
                <p>–†–∞–±–æ—á–∏—Ö –¥–Ω–µ–π: <span id="modal-work-days">0</span></p>
                <p>–°—É–º–º–∞ –ø—Ä–æ–¥–∞–∂: <span id="modal-total-sales">0</span> —Ä—É–±</p>
                <p>–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ –≤—Å–µ–≥–æ: <span id="modal-total-earned">0</span> —Ä—É–±</p>
                <p>–ó–∞—Ä–ø–ª–∞—Ç–∞: <span id="modal-salary">0</span> —Ä—É–±</p>
                <p id="balance-row">–û—Å—Ç–∞—Ç–æ–∫: <span id="modal-balance">0</span> —Ä—É–±</p>
            </div>
        </div>
    </div>
    
    <div id="period-modal" class="modal">
        <div class="modal-content period-selector">
            <span class="close">&times;</span>
            <h3>–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥</h3>
            <div class="period-step" id="year-step">
                <h4>–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ–¥</h4>
                <div class="period-options" id="year-options"></div>
            </div>
            <div class="period-step" id="month-step" style="display:none">
                <h4>–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—è—Ü</h4>
                <div class="period-options" id="month-options"></div>
            </div>
            <button id="period-back" style="display:none">‚Üê –ù–∞–∑–∞–¥</button>
        </div>
    </div>

    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞—Å—á–µ—Ç–æ–≤</h3>
            
            <div class="setting-group">
                <label>–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã:</label>
                <select id="mode-selector">
                    <option value="official">–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ</option>
                    <option value="unofficial">–ù–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ</option>
                </select>
            </div>
            
            <div id="official-settings">
                <div class="setting-group">
                    <label>–ü—Ä–æ—Ü–µ–Ω—Ç —Å –ø—Ä–æ–¥–∞–∂ (%):</label>
                    <input type="number" id="sales-percent" value="7" min="0" max="100" step="0.1">
                </div>
                
                <div class="setting-group">
                    <label>–°—Ç–∞–≤–∫–∞ –∑–∞ —Å–º–µ–Ω—É (—Ä—É–±):</label>
                    <input type="number" id="shift-rate" value="1000" min="0" step="100">
                </div>
                
                <div class="setting-group">
                    <label>–ê–≤–∞–Ω—Å (—Ä—É–±):</label>
                    <input type="number" id="advance" value="10875" min="0" step="1000">
                </div>

                <div class="setting-group">
                    <label>–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —á–∞—Å—Ç—å –∑–∞—Ä–ø–ª–∞—Ç—ã (—Ä—É–±):</label>
                    <input type="number" id="fixed-salary-part" value="10875" min="0" step="1000">
                </div>

                <div class="setting-group">
                    <label>–ó–Ω–∞—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –æ–±–≤–æ–¥–∫–∏ (—Ä—É–±):</label>
                    <input type="number" id="functional-border-value" value="30000" min="0" step="1000">
                </div>
            </div>
            
            <div id="unofficial-settings" style="display: none;">
                <div class="setting-group">
                    <label>–ü—Ä–æ—Ü–µ–Ω—Ç —Å –ø—Ä–æ–¥–∞–∂ (%):</label>
                    <input type="number" id="unofficial-sales-percent" value="7" min="0" max="100" step="0.1">
                </div>
                
                <div class="setting-group">
                    <label>–°—Ç–∞–≤–∫–∞ –∑–∞ —Å–º–µ–Ω—É (—Ä—É–±):</label>
                    <input type="number" id="unofficial-shift-rate" value="1000" min="0" step="100">
                </div>
                
                <div class="setting-group">
                    <label>–ê–≤–∞–Ω—Å (—Ä—É–±):</label>
                    <input type="number" id="unofficial-advance" value="0" min="0" step="1000">
                </div>

                <div class="setting-group">
                    <label>–ó–Ω–∞—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –æ–±–≤–æ–¥–∫–∏ (—Ä—É–±):</label>
                    <input type="number" id="unofficial-functional-border-value" value="30000" min="0" step="1000">
                </div>
            </div>

            <div class="setting-group" style="display: flex; gap: 10px; margin-top: 20px;">
                <button id="export-btn" style="flex: 1;">–≠–∫—Å–ø–æ—Ä—Ç</button>
                <button id="import-btn" style="flex: 1;">–ò–º–ø–æ—Ä—Ç</button>
            </div>

            <div class="setting-group" style="margin-top: 20px;">
                <button id="update-btn" style="width: 100%; background: #dc3545;">–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
            </div>
            
            <button id="save-settings">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        </div>
    </div>

    <!-- –ù–æ–≤—ã–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞/–∏–º–ø–æ—Ä—Ç–∞ -->
    <div id="export-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
            <p id="ios-export-text" style="margin-bottom: 15px; display: none;">
                –ù–∞–∂–º–∏—Ç–µ "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å" —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞. 
                –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤ –Ω–∞–¥–µ–∂–Ω–æ–º –º–µ—Å—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –∑–∞–º–µ—Ç–∫–∞—Ö).
            </p>
            <div style="display: flex; gap: 10px;">
                <button id="copy-data-btn" style="flex: 1;">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                <button id="save-file-btn" style="flex: 1;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª</button>
            </div>
        </div>
    </div>

    <div id="import-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
            <textarea id="import-text-input" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞–∂–º–∏—Ç–µ '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å'" style="height: 120px; margin: 10px 0;"></textarea>
            <div style="display: flex; gap: 10px;">
                <button id="import-file-btn" style="flex: 1;">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</button>
                <button id="import-text-btn" style="flex: 1;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–º–æ—â–∏ -->
    <div id="help-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã</h3>
            <div id="help-content" style="margin-top: 20px;"></div>
        </div>
    </div>

    <!-- –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ -->
    <input type="file" id="import-file" accept=".json" style="display: none;">

    <script src="help.js"></script>
    <script src="script.js"></script>
    <script>
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞ –ø—Ä–∏ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏
        const SW_VERSION = 'v4'; // –î–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –≤–µ—Ä—Å–∏–µ–π –≤ sw.js
        if (localStorage.getItem('sw_version') !== SW_VERSION) {
          caches.keys().then(cacheNames => {
            cacheNames.forEach(cacheName => caches.delete(cacheName));
          }).then(() => {
            localStorage.setItem('sw_version', SW_VERSION);
            console.log('–ö–µ—à –æ—á–∏—â–µ–Ω –¥–ª—è –≤–µ—Ä—Å–∏–∏', SW_VERSION);
          });
        }

        window.addEventListener('load', () => {
            document.getElementById('app-loading').style.display = 'none';
            
            // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('SW registered'))
                    .catch(err => console.error('SW registration error:', err));
            }
        });
    </script>
</body>
</html>
